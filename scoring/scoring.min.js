"use strict";function hideAllContainers(){clearInterval(lastTimeScored),$("#liveScoringPasswordContainer").hide(),$("#endScoringPasswordContainer").hide(),$("#drawResultsContainer").hide(),$("#gameInfoContainer").hide(),$("#gameSelectionContainer").hide(),$("#liveScoringContainer").hide(),$("#endScoringContainer").hide(),$("#contactContainer").hide()}function setActivePage(){$("li.active").removeClass("active");var e="gameSelection"==sessionStorage.currentPage?"liveScoring":sessionStorage.currentPage;$("."+e).addClass("active"),$(".navbar-collapse.in").removeClass("in").prop("aria-expanded",!1)}function pad(e,a){for(e=""+e;e.length<a;)e="0"+e;return e}function addBackEvent(e){if("startDrawResults"==e[0]||"startGameSelection"==e[0]||"startLiveScoring"==e[0]||"startContactForm"==e[0]||"startEndScoring"==e[0])var a={event:e[0]};else if("weekChange"==e[0])var a={event:e[0],weekNumber:e[1]};else if("startGameInfo"==e[0])var a={event:e[0],gameID:e[1]};if(history.replaceState){history.replaceState(a,"",""),history.pushState(a,"","");var t=JSON.parse(sessionStorage.backEvents);t.push(e),sessionStorage.backEvents=JSON.stringify(t)}}function setInstructions(e){var a="";switch(e){case"drawResults":a="If you want the scores to update automatically, choose how often you want that to happen to the right. You can change the week displayed by clicking 'Show Weeks' then selecting the week you want. The games are colour coded to represent the situation in the game. To display the games for a division, click the division title. Clicking the title again will hide them. Clicking a game will take you to a full page display of the game including all the scoring plays (if provided).";break;case"liveScoringPassword":a="Input the password provided to you and tap 'Submit'";break;case"gameSelection":a="Choose the correct division, home and away teams and tap 'Select Game'";break;case"liveScoring":a="To upload a scoring play, tap the name of the team and the scoring play you want to upload, enter the minutes played and description of play (optional), then tap 'Send'. If you missed some plays, you can tap 'Change Score' and enter the current score and minutes played then tap 'Submit'. If you want to delete play/s, tap the plays you want to delete then tap 'Delete Selected Plays'. Tapping the 'Half Time' or 'Full Time' buttons will upload that play to the database. Once you have finished scoring the game, tap 'Stop Scoring' to be logged out.";break;case"endScoringPassword":a="Input the password provided to you and tap 'Submit'";break;case"endScoring":a="To upload the final score for a game, select the division, home team, away team, enter the score for each team, the date the game was played then tap 'Submit Score'"}$("#instructions").text(a)}function toggleInstructions(){$("#instructions").toggle(),localStorage.instructions="true"==localStorage.instructions?"false":"true"}function getTeamName(e,a){e=String(parseInt(e)),a=parseInt(a);for(var t=0;t<allTeams[a].length;t+=1)if(e==allTeams[a][t].teamID)return allTeams[a][t].teamName;return""}function columnName(e){switch(e){case"homeTeamScore":return"Home Score";case"awayTeamScore":return"Away Score";case"time":return"Start Time";case"location":return"Location";case"ref":return"Referee";case"assRef1":return"Assistant Referee";case"locked":return"Locked";case"date":return"Date"}}function alertError(e,a){$(".footer").show(),$(e).after("<div class='alert alert-danger' role='alert'>"+a+"</div>"),$(e).next().delay(4e3).fadeOut(600),setTimeout(function(){$(e).next().remove(),$(".footer").hide()},5e3)}function alertSuccess(e,a){$(".footer").show(),$(e).after("<div class='alert alert-success' role='alert'>"+a+"</div>"),$(e).next().delay(4e3).fadeOut(600),setTimeout(function(){$(e).next().remove(),$(".footer").hide()},5e3)}function alertNotification(e,a){$(".footer").show(),$(e).after("<div class='alert alert-info' role='alert'>"+a+"</div>"),$(e).next().delay(4e3).fadeOut(600),setTimeout(function(){$(e).next().remove(),$(".footer").hide()},5e3)}function drawResults(e){null==localStorage.instructions&&(localStorage.instructions="true"),updateDuration=null!=localStorage.updateDuration?localStorage.updateDuration:60,currentWeek=null!=localStorage.currentWeek?parseInt(localStorage.currentWeek):0,e&&addBackEvent(["startDrawResults"]),sessionStorage.currentPage="drawResults",setActivePage(),generateWeekSelector(),setActiveUpdateInterval(),generateChangedGames(),generateGames(),showDrawResultsContainer()}function showDrawResultsContainer(){hideAllContainers(),setInstructions("drawResults"),$("#drawResultsContainer").show()}function toggleWeeks(){$("#weeksList").slideToggle()}function toggleGameChanges(){$("#gameChanges").slideToggle(),localStorage.lastTimeUpdatesChecked=(new Date).toUTCString(),gameChangesExpanded=gameChangesExpanded?!1:!0}function toggleGameCancellations(){$("#gameCancellations").slideToggle()}function generateWeekSelector(){var e=new Date(startDateArray[0],startDateArray[1],startDateArray[2]),a=new Date(startDateArray[0],startDateArray[1],startDateArray[2]).addDays(6),t="";t+="<div id='autoUpdateButtonRow'>",t+="    Auto Update: ",t+="    <button id='au30' class='autoUpdateButton' onclick='changeAutoUpdateInterval(30)'>30s</button>",t+="    <button id='au60' class='autoUpdateButton' onclick='changeAutoUpdateInterval(60)'>1m</button>",t+="    <button id='au300' class='autoUpdateButton' onclick='changeAutoUpdateInterval(300)'>5m</button>",t+="    <button id='au900' class='autoUpdateButton' onclick='changeAutoUpdateInterval(900)'>15m</button>",t+="    <button id='au100000' class='autoUpdateButton' onclick='changeAutoUpdateInterval(NEVER)'>Never</button>",t+="</div>",t+="<div class='weektoggledisplay col-xs-47'>",t+="    <div onclick='toggleWeeks()' class='showweeks'>Show Weeks</div>",t+="        <nav id='weeksList' class='row'>";for(var s=0;numWeeks>s;s+=1)t+="        <button onclick='changeWeeks("+s+", true)' class='weeknav week"+(s+1)+" col-xs-12 col-sm-6'>",t+="            <div class='weektitle'>W"+(s+1)+"</div>",t+="            <div class='date'>"+e.toCustomDateString(!1)+" - "+a.toCustomDateString(!1)+"</div>",t+="        </button>",e=e.addDays(7),a=a.addDays(7);t+="        </nav>",t+="    </div>",t+="</div>",t+="<div class='row colourLegend'>",t+="    <div class='colour col-xs-24'>",t+="        <div class='blueSquare'></div>",t+="        <div class='colourLabel'>Not Started</div>",t+="    </div>",t+="    <div class='colour col-xs-24'>",t+="        <div class='greenSquare'></div>",t+="        <div class='colourLabel'>Being Live Scored</div>",t+="    </div>",t+="</div>",t+="<div class='row colourLegend'>",t+="    <div class='colour col-xs-24'>",t+="        <div class='yellowSquare'></div>",t+="        <div class='colourLabel'>Live Scoring Not Completed</div>",t+="    </div>",t+="    <div class='colour col-xs-24'>",t+="        <div class='redSquare'></div>",t+="        <div class='colourLabel'>Game Finished</div>",t+="    </div>",t+="</div>",$("#weekSelectorContainer").empty().append(t),setActiveWeek()}function generateGameCancellations(e,a){var t="",s=!1,o=new Date;if(o>=e&&a>=o){if(t+="<div class='cancellationtoggledisplay col-xs-47'>",t+="    <div onclick='toggleGameCancellations()'>Show Game Cancellations</div>",t+="        <div id='gameCancellations'>",null!=allGames)for(var n=0;n<allGames.length;n+=1){var r=allGames[n],i=r.GameID,l=parseInt(i.substr(0,4)),c=parseInt(i.substr(4,2))-1,d=parseInt(i.substr(6,2)),u=new Date(l,c,d);if(a>=u&&u>=e&&"y"==r.cancelled){var m=parseInt(i.slice(-2));if(16==i.length)var g=getTeamName(i.substr(8,3),m),v=getTeamName(i.substr(11,3),m);else var g=r.homeTeamName,v=r.awayTeamName;t+="<div onclick='toggleGameCancellations()'>"+allDivs[m].divisionName+" - "+g+" vs "+v+"</div>",s=!0}}t+="        </div>",t+="    </div>",t+="</div>",$("#gameCancellationContainer").empty().append(t),s||$(".cancellationtoggledisplay").hide()}else $("#gameCancellationContainer").empty()}function generateChangedGames(e,a){var t=new Date(localStorage.lastTimeUpdatesChecked),s="",o=!1,n=new Date;if(n>=e&&a>=n){if(s+="<div class='changestoggledisplay col-xs-47'>",s+="    <div onclick='toggleGameChanges()'>Show Game Changes</div>",s+="        <div id='gameChanges'>",null!=allGames)for(var r=0;r<allGames.length;r+=1){var i=allGames[r],l=i.GameID,c=parseInt(l.substr(0,4)),d=parseInt(l.substr(4,2))-1,u=parseInt(l.substr(6,2)),m=new Date(c,d,u);if(a>=m&&m>=e)for(var g=JSON.parse(allGames[r].changes),v=0;v<g.length;v+=1){var p=new Date(g[v][0]);if(p>t){var h=parseInt(l.slice(-2));if(16==l.length)var f=getTeamName(l.substr(8,3),h),w=getTeamName(l.substr(11,3),h);else var f=i.homeTeamName,w=i.awayTeamName;if(o=!0,"date"==g[v][1])var S=g[v][2],y=new Date(S.substr(0,4),S.substr(4,2),S.substr(6,2)).toCustomDateString(!0);else var y=g[v][2];s+="<div onclick='toggleGameChanges()>"+allDivs[h].divisionName+") "+f+" vs "+w+" - "+columnName(g[v][1])+" was changed to "+y+" ("+p.toChangesString()+")</div>"}}}s+="        </div>",s+="    </div>",s+="</div>",$("#changedGamesContainer").empty().append(s),o||$(".changestoggledisplay").hide(),gameChangesExpanded&&$("#gameChanges").show()}else $("#changedGamesContainer").empty()}function generateGames(){var e="",a=[],t=new Date(startDateArray[0],startDateArray[1],startDateArray[2]).addDays(7*currentWeek),s=new Date(startDateArray[0],startDateArray[1],startDateArray[2]).addDays(6+7*currentWeek),o=$.post("http://www.ccrscoring.co.nz/scripts/php/getallgames.php",{start:pad(t.getFullYear(),4)+pad(t.getMonth()+1,2)+pad(t.getDate(),2),end:pad(s.getFullYear(),4)+pad(s.getMonth()+1,2)+pad(s.getDate(),2)},function(o){allGames=o,generateGameCancellations(t,s),generateChangedGames(t,s);for(var n=0;n<allDivs.length;n+=1){var r=0,i=!1;if(e+="<div id='div"+allDivs[n].divisionID+"Row' class='row rowfix'>",e+="    <div class='titleRow clearfix'>",e+="        <div class='col-xs-28' onclick='toggleGames(\"div"+allDivs[n].divisionID+"\");'>",e+="            <h3>"+allDivs[n].divisionName+"</h3>",e+="        </div>",e+="        <div class='col-xs-20 pointsTableButtonContainer'>",e+="            <button id='pointsTableButton' onclick='showPointsTable(\""+allDivs[n].divisionID+"\")'>Points Table</button>",e+="        </div>",e+="    </div>",e+="    <div class='col-xs-48 gamerowcontainer div"+allDivs[n].divisionID+"'>",e+="        <div class='row gamerow'>",null!=allGames)for(var l=0;l<allGames.length;l+=1){var c=allGames[l].GameID,d=(parseInt(c.slice(-2)),c.substr(0,8)),u=parseInt(d.substr(0,4)),m=parseInt(d.substr(4,2))-1,g=parseInt(d.substr(6,2)),v=new Date(u,m,g);if(s>=v&&v>=t&&c.slice(-2)==allDivs[n].divisionID){if(i=!0,16==c.length)var p=getTeamName(c.substr(8,3),c.slice(-2)),h=getTeamName(c.substr(11,3),c.slice(-2));else var p=allGames[l].homeTeamName,h=allGames[l].awayTeamName;var f="",w="";"y"==allGames[l].locked?(f="Full Time",w="finished"):0==allGames[l].minutesPlayed?(f=v.toCustomDateString(!0)+" "+allGames[l].time,w="notstarted"):80==allGames[l].minutesPlayed?(f="Full Time",w="finished"):40==allGames[l].minutesPlayed&&"y"==allGames[l].liveScored?(f="Half Time",w="inprogress"):40==allGames[l].minutesPlayed&&"n"==allGames[l].liveScored?(f="Half Time",w="startedbutnotscored"):"y"==allGames[l].liveScored?(f=allGames[l].minutesPlayed+" mins",w="inprogress"):(f=allGames[l].minutesPlayed+" mins",w="startedbutnotscored");var S="",y="";2==allGames[l].homeTeamScore?(S="Win",y="Defaulted"):1==allGames[l].homeTeamScore?(S="Defaulted",y="Win"):(S=allGames[l].homeTeamScore,y=allGames[l].awayTeamScore);var D="";parseInt(allGames[l].homeTeamScore)>parseInt(allGames[l].awayTeamScore)?D="home":parseInt(allGames[l].awayTeamScore)>parseInt(allGames[l].homeTeamScore)&&(D="away");var I="",b=allGames[l].ref,P=allGames[l].assRef1,T=allGames[l].assRef2;""!=b?(I="Ref: "+b,""!=P?(I=I+", Assis. Ref: "+P,""!=T&&(I=I+" and "+T)):""!=T&&(I=I+", Assis. Ref: "+T)):""!=P?(I=I+"Assis. Ref: "+P,""!=T&&(I=I+" and "+T)):""!=T&&(I=I+"Assis. Ref: "+T),e+="            <div class='col-sm-15 game "+w+"' onclick='gameInfo("+allGames[l].GameID+", true);'>",e+="                <div class='row'>",e+="                    <div class='col-xs-48 location'>"+allGames[l].location+" - "+f+"</div>",e+="                </div>",e+="                <div class='row'>",e+="                    <div class='col-xs-48 refs'>"+I+"</div>",e+="                </div>",e+="                <div class='row teams hometeam'>","home"==D&&(e+="<div class='strong'>"),e+="                    <div class='teamname col-xs-20 col-sm-33'>"+p+"</div>",e+="                    <div class='score col-xs-16 col-sm-15'>"+S+"</div>","home"==D&&(e+="</div>"),e+="                </div>",e+="                <div class='row teams hometeam'>","away"==D&&(e+="<div class='strong'>"),e+="                    <div class='teamname col-xs-20 col-sm-33'>"+h+"</div>",e+="                    <div class='score col-xs-16 col-sm-15'>"+y+"</div>","away"==D&&(e+="</div>"),e+="                </div>",e+="            </div><!-- End of game div -->",r+=1,3==r&&(e+="    </div><!-- End of gamerow div -->",e+="    <div class='row gamerow'>",r=0)}}e+="        </div><!-- End of gamerow div -->",e+="    </div><!-- End of gamerowcontainer div -->",e+="</div><!-- End of row div -->",0==i&&a.push(allDivs[n].divisionID)}null==allGames&&(e+="<div class='noGamesMessage'>No Games For This Week Yet</div>"),$("#gameContainer").empty().append(e);for(var k=0;k<a.length;k+=1)$("#div"+a[k]+"Row").hide();restoreExpandedDivisions(),startAutoUpdateTimer(),setActiveWeek()},"json");o.fail(function(){alertError("#alertDiv","Error while displaying games. Please try again later. If problem persists, use the contact form")})}function changeWeeks(e,a){a&&addBackEvent(["weekChange",parseInt(currentWeek)]),currentWeek=e,localStorage.currentWeek=currentWeek,generateGames(),alertNotification("#alertDiv","Week Changed")}function setActiveWeek(){$(".weeknav.active").removeClass("active"),$(".week".concat(currentWeek+1)).addClass("active")}function setActiveUpdateInterval(){$(".autoUpdateButton.active").removeClass("active"),$("#au".concat(updateDuration)).addClass("active")}function restoreExpandedDivisions(){for(var e=0;e<expandedDivisions.length;e+=1)$("."+expandedDivisions[e]).show()}function toggleGames(e){$(".".concat(e)).slideToggle();var a=expandedDivisions.indexOf(e);-1==a?expandedDivisions.push(e):expandedDivisions.splice(a,1)}function startAutoUpdateTimer(){stopAutoUpdateTimer(),autoUpdateTimer=setTimeout(generateGames,1e3*updateDuration)}function changeAutoUpdateInterval(e){if(e==NEVER)updateDuration!=NEVER&&void 0!=updateDuration&&(updateDuration=NEVER,stopAutoUpdateTimer(),alertSuccess("#alertDiv","Games won't automatically update anymore"));else{if(updateDuration=e,startAutoUpdateTimer(),30==e)var a="30 seconds";else if(60==e)var a="minute";else if(300==e)var a="5 minutes";else if(900==e)var a="15 minutes";alertSuccess("#alertDiv","Games will automatically update every "+a)}localStorage.updateDuration=updateDuration,setActiveUpdateInterval()}function stopAutoUpdateTimer(){clearTimeout(autoUpdateTimer)}function showPointsTable(e){var a="";$.post("http://www.ccrscoring.co.nz/scripts/php/getpointstable.php",{divisionID:e},function(e){e[0].sort(function(e,a){return e.compPoints==a.compPoints?e.pointsDiff==a.pointsDiff?getTeamName(a.teamID,a.divID)-getTeamName(e.teamID,e.divID):a.pointsDiff-e.pointsDiff:a.compPoints-e.compPoints}),a+="<img id='dialogCloseButton' src='http://www.ccrscoring.co.nz/images/close.png' alt='close' onclick='closePointsTable()'>",a+="<div id='dialogContent'>",a+="    <table id='pointsTableTable'>",a+="        <thead>",a+="            <tr>",a+="                <th class='desktopHeader'>Team</th>",a+="                <th class='desktopHeader'>Played</th>",a+="                <th class='desktopHeader'>Won</th>",a+="                <th class='desktopHeader'>Drawn</th>",a+="                <th class='desktopHeader'>Lost</th>",a+="                <th class='desktopHeader'>Points For</th>",a+="                <th class='desktopHeader'>Points Against</th>",a+="                <th class='desktopHeader'>Points Diff</th>",a+="                <th class='desktopHeader'>4 Try Bonus</th>",a+="                <th class='desktopHeader'>7 Point Bonus</th>",a+="                <th class='desktopHeader'>Points</th>",a+="                <th class='mobileHeader'>Team</th>",a+="                <th class='mobileHeader'>P</th>",a+="                <th class='mobileHeader'>W</th>",a+="                <th class='mobileHeader'>D</th>",a+="                <th class='mobileHeader'>L</th>",a+="                <th class='mobileHeader'>PF</th>",a+="                <th class='mobileHeader'>PA</th>",a+="                <th class='mobileHeader'>PD</th>",a+="                <th class='mobileHeader'>B1</th>",a+="                <th class='mobileHeader'>B2</th>",a+="                <th class='mobileHeader'>CP</th>",a+="            </tr>",a+="        </thead>",a+="        <tbody>";for(var t=0;t<e[0].length;t+=1){var s=e[0][t];a+="        <tr class='"+(3>t?"playoff":3==t?"playoff last":"")+"'>",a+="            <td>"+getTeamName(s.teamID,s.divisionID)+"</td>",a+="            <td>"+s.gamesPlayed+"</td>",a+="            <td>"+s.gamesWon+"</td>",a+="            <td>"+s.gamesDrawn+"</td>",a+="            <td>"+s.gamesLost+"</td>",a+="            <td>"+s.pointsFor+"</td>",a+="            <td>"+s.pointsAgainst+"</td>",a+="            <td>"+s.pointsDiff+"</td>",a+="            <td>"+s.fourTryBonus+"</td>",a+="            <td>"+s.sevenPointBonus+"</td>",a+="            <td>"+s.compPoints+"</td>",a+="        </tr>"}if(a+="        </tbody>",a+="        <tfoot></tfoot>",a+="    </table>",e[1].length>0){a+="<div class='pointsTableMissing'>Games missing from points table:</div>";for(var o=0;o<e[1].length;o+=1){var n=e[1][o].GameID,r=parseInt(n.substr(0,4)),i=parseInt(n.substr(4,2))-1,l=parseInt(n.substr(6,2)),c=new Date(r,i,l).toAddGameDateString();a+="<div class='pointsTableMissing'>"+getTeamName(n.substr(8,3),n.slice(-2))+" vs "+getTeamName(n.substr(11,3),n.slice(-2))+" ("+c+")</div>"}}a+="    <button id='closePointsTable' onclick='closePointsTable()'>Close</button>",a+="</div>",a+="<div id='blackOverlay'></div>",$("#pointsTableDialog").empty().append(a),$("#dialogContent").show(),$("#blackOverlay").show(),"none"==$(".mobileHeader").css("display")&&$("#dialogCloseButton").show(),$("#pointsTableDialog").show()},"json")}function closePointsTable(){$("#dialogContent").hide(),$("#blackOverlay").hide(),$("#dialogCloseButton").hide()}function gameInfo(e,a){changeAutoUpdateInterval(NEVER),a&&addBackEvent(["startGameInfo",String(parseInt(e))]),sessionStorage.currentPage="gameInfo",sessionStorage.currentGameID=e,generateGameInfo(),showGameInfoContainer()}function showGameInfoContainer(){hideAllContainers(),$("#gameInfoContainer").show()}function generateGameInfo(){var e=sessionStorage.currentGameID,a="",t=$.post("http://www.ccrscoring.co.nz/scripts/php/getgameinfo.php",{gameID:e},function(t){var s="",o="";"2"==t[0].homeTeamScore?(s="Win",o="Defaulted"):"1"==t[0].homeTeamScore?(s="Defaulted",o="Win"):(s=t[0].homeTeamScore,o=t[0].awayTeamScore),a+="<div id='gameInfoHeader'>",a+="    <div class='row teamInfo rowfix'>",a+="        <div class='col-xs-22'>",a+="            <div class='row'>"+t[0].homeTeamName+"</div>",a+="            <div class='row'>"+s+"</div>",a+="        </div>",a+="        <div class='col-xs-4 versus'>vs</div>",a+="        <div class='col-xs-22'>",a+="            <div class='row'>"+t[0].awayTeamName+"</div>",a+="            <div class='row'>"+o+"</div>",a+="        </div>",a+="    </div>";var n=e.substr(0,8),r=parseInt(n.substr(0,4)),i=parseInt(n.substr(4,2))-1,l=parseInt(n.substr(6,2)),c=new Date(r,i,l),d="";d="0"==t[0].minutesPlayed?c.toCustomDateString(!0)+" "+t[0].time:"80"==t[0].minutesPlayed?"Full Time":"40"==t[0].minutesPlayed?"Half Time":t[0].minutesPlayed+" mins",a+="    <div class='row gameInfo rowfix'><div class='col-xs-48'>"+t[0].location+"</div></div>",a+="    <div class='row gameInfo rowfix'><div class='col-xs-48'>"+d+"</div></div>",a+="</div>",a+="<div class='row scoringPlays rowfix'>\n\n";for(var u=JSON&&JSON.parse(t[0].scoringPlays)||$.parseJSON(t[0].scoringPlays),m=0,g=0,v=0;v<u.length;v+=1){var p=u[v],h=p[1],f=h.substr(0,4),w=h.substr(4);if("DropGoal"==w&&(w="Drop Goal"),"Time"==w)a+="<div class='row time rowfix'>\n",a+="<div class='col-xs-48'>"+m+"-"+g+"</div>\n",a+="<div class='col-xs-48'>",a+="half"==f?"Half Time":"Full Time",a+="</div>\n</div>\n\n";else if("strt"==f)a+="<div class='row gameStart rowfix'>\n<div class='col-xs-48'>Game Started</div>\n</div>\n\n";else if("updt"==f)if(6==w.length){if(2==parseInt(w.substr(0,3)))var S="Game Update: "+t[0].awayTeamName+" defaulted";else if(1==parseInt(substr(w,0,3)))var S="Game Update: "+t[0].homeTeamName+" defaulted";else var S="Score Update: "+parseInt(w.substr(0,3))+" - "+parseInt(w.substr(3,3))+" ("+p[0]+"')";a+="<div class='row update rowfix'>\n	<div class='col-xs-48'>"+S+"</div>\n</div>\n\n",m=parseInt(w.substr(0,3)),g=parseInt(w.substr(3,3))}else S=2==parseInt(w.substr(0,2))?"Game Update: "+t[0].awayTeamName+" defaulted":1==parseInt(w.substr(0,2))?"Game Update: "+t[0].homeTeamName+" defaulted":"Score Update: "+parseInt(w.substr(0,2))+" - "+parseInt(w.substr(2,2))+" ("+p[0]+"')",a+="<div class='row update rowfix'>\n	<div class='col-xs-48'>"+S+"</div>\n</div>\n\n",m=parseInt(w.substr(0,2)),g=parseInt(w.substr(2,2));else{var f=h.substr(0,4);switch(w){case"Try":"home"==f?m+=5:g+=5;break;case"Penalty":case"Drop Goal":"home"==f?m+=3:g+=3;break;case"Conversion":"home"==f?m+=2:g+=2}a+="<div class='row scoringPlay rowfix'>\n",a+="	<div class='col-xs-20 homeScoringPlay'>","home"==f&&(a+=w),a+="</div>\n	<div class='col-xs-8 minutesPlayed'>"+m+" - "+g+" ("+p[0]+"')</div>\n",a+="	<div class='col-xs-20 awayScoringPlay'>","away"==f&&(a+=w),a+="</div>\n",a+="	<div class='col-xs-48'>"+p[2]+"</div>\n",a+="</div>\n\n"}}a+="</div>\n\n",$("#gameInfoContainer").empty().append(a)},"json");t.fail(function(){alertError("#alertDiv","Error while getting game info. Please try again later. If problem persists, use the contact form")})}function liveScoring(){changeAutoUpdateInterval(NEVER),"correct"==sessionStorage.liveScoringPassword?generateGameSelection():(sessionStorage.currentPage="gameSelection",setActivePage(),showLiveScoringPasswordContainer()),addEventsLive()}function addEventsLive(){$("#liveScoringPasswordContainer").on({keydown:function(e){13==e.which&&(e.preventDefault(),$("#checkLiveScoringPasswordButton").click())}})}function showLiveScoringPasswordContainer(){hideAllContainers(),setInstructions("liveScoringPassword"),$("#liveScoringPasswordContainer").show()}function checkLiveScoringPassword(){var e=$("#liveScoringPasswordInput").val();$.post("http://www.ccrscoring.co.nz/scripts/php/checkpassword.php",{page:"liveScoring",password:e},function(e){"correct"==e?(sessionStorage.liveScoringPassword="correct",sessionStorage.currentPage="gameSelection",setActivePage(),liveScoring()):"incorrect"==e?(alertError("#alertDiv","Incorrect password. Please try again."),$("#liveScoringPasswordInput").val=""):alertError("#alertDiv","Error: "+e+". Please try again later. If problem persists, use the contact form")}).fail(function(){alertError("#alertDiv","Error while checking password. Please try again later. If problem persists, use the contact form")})}function showGameSelectionContainer(){hideAllContainers(),setInstructions("gameSelection"),$("#gameSelectionContainer").show(),lastTimeScored=setInterval(updateLastTimeScored,3e4)}function showLiveScoringContainer(){hideAllContainers(),setInstructions("liveScoring"),$("#liveScoringContainer").show(),lastTimeScored=setInterval(updateLastTimeScored,3e4)}function toggleChangeScoreForm(){$(".changeScoreForm").toggle()}function generateGameSelection(){var e="";e+="<div class='row divDropDownRow rowfix'>",e+="    Grade:",e+="    <select id='teamSelectionDivisionDropDown' onchange='changeTeamDropdowns()'>";for(var a=0;a<allDivs.length;a+=1)e+="<option value="+allDivs[a].divisionID+">"+allDivs[a].divisionName+"</option>";e+="    </select>",e+="</div>",e+="<div class='row homeTeamRow rowfix'>",e+="    Home Team: <select id='teamSelectionHomeTeamDropDown'>";for(var t=0;t<allTeams[selectedDivisionIndex].length;t+=1)e+="    <option value='"+allTeams[selectedDivisionIndex][t].teamID+"'>"+allTeams[selectedDivisionIndex][t].teamName+"</option>";e+="    </select>",e+="</div>",e+="<div class='row awayTeamRow rowfix'>",e+="    Away Team: <select id='teamSelectionAwayTeamDropDown'>";for(var s=0;s<allTeams[selectedDivisionIndex].length;s+=1)e+="    <option value='"+allTeams[selectedDivisionIndex][s].teamID+"'>"+allTeams[selectedDivisionIndex][s].teamName+"</option>";e+="    </select>",e+="</div>",e+="<div class='row selectGameButtonRow'>",e+="    <div class='col-xs-48'><button class='selectGameButton' onClick='selectGame()'>Select Game</button></div>",e+="</div>";var o=JSON.parse(sessionStorage.scoringGameID);e+="<div id='currentScoringContainer' class='col-xs-47'>",e+="<div id='currentScoringContainerTitle'>Games you are scoring</div>";for(var n=0;n<o.length;n+=1){var r=o[n],i=parseInt(r[0].slice(-2));e+="<div class='currentScoringGameRow "+r[0]+"' onclick='startLiveScoring("+r[0]+")'>"+allDivs[i].divisionName+" - "+r[1]+" vs "+r[2]+"</div>"}e+="</div>",$("#gameSelectionContainer").empty().append(e),0==o.length&&$("#currentScoringContainer").hide(),$("#teamSelectionDivisionDropDown").prop("selectedIndex",selectedDivisionIndex),showGameSelectionContainer(),addBackEvent(["startGameSelection"]),sessionStorage.currentPage="gameSelection",setActivePage()}function generateLiveScoring(){var e="",a=sessionStorage.currentGameID,t=$.post("http://www.ccrscoring.co.nz/scripts/php/getgameinfo.php",{gameID:a},function(t){if(16==a.length)var s=getTeamName(a.substr(8,3),a.slice(-2)),o=getTeamName(a.substr(11,3),a.slice(-2));else var s=t[0].homeTeamName,o=t[0].awayTeamName;var n=t[0].homeTeamScore,r=t[0].awayTeamScore;e+="<div class='row stopScoringButtonRow rowfix'>",e+="    <button type='submit' class='stopScoringButton col-xs-48' onclick='stopScoring("+a+")'>Stop Scoring</button>",e+="</div>",e+="<div class='row changeScoreFormButtonRow rowfix'>",e+="    <button type='button' class='changeScoreFormToggleButton col-xs-48' onclick='toggleChangeScoreForm()'>Change Score</button>",e+="</div>",e+="<div class='row rowfix'>",e+="    <div class='changeScoreForm col-xs-48'>",e+="        <div class='row changeScoreInputRow rowfix'>",e+="            <div class='changeScoreFormLabel col-xs-10'>"+s+":</div><input class='col-xs-18' type='number' id='newhomescore'><br>",e+="        </div>",e+="        <div class='row changeScoreInputRow rowfix'>",e+="            <div class='changeScoreFormLabel col-xs-10'>"+o+":</div><input class='col-xs-18' type='number' id='newawayscore'><br>",e+="        </div>",e+="        <div class='row changeScoreInputRow rowfix'>",e+="            <div class='changeScoreFormLabel col-xs-10'>Minutes Played:</div><input class='col-xs-18' type='number' id='newminutesplayed'><br>",e+="        </div>",e+="        <div class='row changeScoreInputRow rowfix'>",e+="            <button id='changeScoreFormButton' onclick='changeScore("+a+")'>Submit New Score</button>",e+="        </div>",e+="    </div>",e+="</div>\n\n",e+="<div class='row rowfix timingInfoLive'>",e+="    <button type='button' class='halftime col-xs-23' onclick='sendHalfTime("+a+","+n+","+r+")'>Half Time</button>",e+="    <button type='button' class='fulltime col-xs-23' onclick='sendFullTime("+a+","+n+","+r+")'>Full Time</button>",e+="</div>\n\n";var i="",l="";"2"==n?(i="Win",l="Defaulted"):"1"==n?(i="Defaulted",l="Win"):(i=n,l=r),e+="<div class='row rowfix teamInfoLive'>",e+="    <div class='homeTeamName col-xs-24'>"+s+"</div>",e+="    <div class='awayTeamName col-xs-24'>"+o+"</div>",e+="</div>",e+="<div class='row rowfix scoreInfoLive'>",e+="    <div class='homeTeamScore col-xs-24'>"+i+"</div>",e+="    <div class='awayTeamScore col-xs-24'>"+l+"</div>",e+="</div>\n\n",e+="<div class='row rowfix scoringPlayInfoLive'>",e+="    <div class='scoringPlayLive homeTry col-xs-24' onclick='toggleSelectedScoringPlay(this, \"homeTry\")'>Try</div>",e+="    <div class='scoringPlayLive awayTry col-xs-24' onclick='toggleSelectedScoringPlay(this, \"awayTry\")'>Try</div>",e+="</div>",e+="<div class='row rowfix scoringPlayInfoLive'>",e+="    <div class='scoringPlayLive homePenalty col-xs-24' onclick='toggleSelectedScoringPlay(this, \"homePenalty\")'>Penalty</div>",e+="    <div class='scoringPlayLive awayPenalty col-xs-24' onclick='toggleSelectedScoringPlay(this, \"awayPenalty\")'>Penalty</div>",e+="</div>",e+="<div class='row rowfix scoringPlayInfoLive'>",e+="    <div class='scoringPlayLive homeDropGoal col-xs-24' onclick='toggleSelectedScoringPlay(this, \"homeDropGoal\")'>Drop Goal</div>",e+="    <div class='scoringPlayLive awayDropGoal col-xs-24' onclick='toggleSelectedScoringPlay(this, \"awayDropGoal\")'>Drop Goal</div>",e+="</div>\n\n",e+="<div class='row rowfix scoringInfoLive'>",e+="    <div class='minutesPlayedLive col-xs-17'>Minutes Played</div>",e+="    <input type='number' class='minutesPlayedInput col-xs-31' value='"+t[0].minutesPlayed+"' step='1' min='1' max='125'></input>",e+="</div>",e+="<div class='row rowfix scoringInfoLive'>",e+="    <div class='descriptionLive col-xs-17'>Description</div>",e+="    <textarea rows='3' class='descriptionInput col-xs-31'></textarea>",e+="</div>",e+="<div class='row rowfix scoringInfoLive'>",e+="    <button type='submit' class='submitPlay col-xs-48' onclick='uploadScoringPlay("+a+", "+n+", "+r+")'>Submit Play</button>",e+="</div>\n\n",e+="<div class='row deletePlayButtonRow rowfix'>",e+="    <div class='btn col-xs-48'>",e+="        <div class='btn-back'>",e+="            <p>Are you sure you want to delete the selected plays?</p>",e+="            <button class='yes'>Yes</button>",e+="            <button class='no'>No</button>",e+="        </div>",e+="        <div class='btn-front col-xs-48'>Delete Selected Plays</div>",e+="    </div>",e+="</div>\n\n",e+="<div class='row scoringPlays rowfix'>\n\n";for(var c=JSON&&JSON.parse(t[0].scoringPlays)||$.parseJSON(t[0].scoringPlays),d=0,u=0,m="",g=0;g<c.length;g+=1){var v=c[g],p=v[1],h=p.substr(0,4),f=p.substr(4);if("DropGoal"==f&&(f="Drop Goal"),"Time"==f)e+="<div class='row time rowfix' onclick='togglePlayInSelectedPlays(this, \""+a+'", '+g+', "'+p.substr(0,4)+'", "'+p.substr(4)+'", '+parseInt(n)+", "+parseInt(r)+", 0, 0)'>\n",e+="<div class='col-xs-48'>"+d+"-"+u+"</div>\n",e+="<div class='col-xs-48'>",e+="half"==h?"Half Time":"Full Time",e+="</div>\n</div>\n\n";else if("strt"==h)e+="<div class='row gameStart rowfix'>\n<div class='col-xs-48'>Game Started</div>\n</div>\n\n";else if("updt"==h)m=m+","+g,6==f.length?(2==parseInt(f.substr(0,3))?scoreString="Game Update: "+o+" defaulted":1==parseInt(f.substr(0,3))?scoreString="Game Update: "+s+" defaulted":scoreString="Score Update: "+parseInt(f.substr(0,3))+" - "+parseInt(f.substr(3,3))+" ("+v[0]+"')",e+="<div class='row update rowfix' onclick='togglePlayInSelectedPlays(this, \""+a+'", '+g+', "'+p.substr(0,4)+'", "'+p.substr(4)+'", '+parseInt(n)+", "+parseInt(r)+", "+d+", "+u+")'>\n	<div class='col-xs-48'>"+scoreString+"</div>\n</div>\n\n",d=parseInt(f.substr(0,3)),u=parseInt(f.substr(3,3))):(2==parseInt(f.substr(0,2))?scoreString="Game Update: "+o+" defaulted":1==parseInt(f.substr(0,2))?scoreString="Game Update: "+s+" defaulted":scoreString="Score Update: "+parseInt(f.substr(0,2))+" - "+parseInt(f.substr(2,2))+" ("+v[0]+"')",e+="<div class='row update rowfix' onclick='togglePlayInSelectedPlays(this, \""+a+'", '+g+', "'+p.substr(0,4)+'", "'+p.substr(4)+'", '+parseInt(n)+", "+parseInt(r)+", "+d+", "+u+")'>\n	<div class='col-xs-48'>"+scoreString+"</div>\n</div>\n\n",d=parseInt(f.substr(0,2)),u=parseInt(f.substr(2,2)));else{switch(h=p.substr(0,4),f){case"Try":"home"==h?d+=5:u+=5;
break;case"Penalty":case"Drop Goal":"home"==h?d+=3:u+=3;break;case"Conversion":"home"==h?d+=2:u+=2}e+="<div class='row scoringPlay rowfix' onclick='togglePlayInSelectedPlays(this, \""+a+'", '+g+', "'+p.substr(0,4)+'", "'+p.substr(4)+'", '+parseInt(n)+", "+parseInt(r)+", 0, 0)'>\n",e+="	<div class='col-sm-20 col-xs-15 homeScoringPlay'>","home"==h&&(e+=f),e+="</div>\n	<div class='col-sm-8 col-xs-18 minutesPlayed'>"+d+" - "+u+" ("+v[0]+"')</div>\n",e+="	<div class='col-sm-20 col-xs-15 awayScoringPlay'>","away"==h&&(e+=f),e+="</div>\n",e+="	<div class='col-xs-48'>"+v[2]+"</div>\n",e+="</div>\n\n"}}e+="</div>\n\n",e+="<span id='updatePlayIndexes' style='display: none'>"+m+"</span>",$("#liveScoringContainer").empty().append(e),showLiveScoringContainer(),sessionStorage.currentPage="liveScoring",setActivePage(),addBackEvent(["startLiveScoring"]),initButtonFlip()},"json");t.fail(function(){alertError("#alertDiv","Error while adding game. Please try again later. If problem persists, use the contact form")})}function startLiveScoring(e){sessionStorage.currentGameID=e,checkGameLive("","",!0)}function changeTeamDropdowns(){selectedDivisionIndex=$("#teamSelectionDivisionDropDown").prop("selectedIndex"),generateGameSelection()}function selectGame(){var e=new Date,a=pad(e.getDate(),2),t=pad(e.getMonth()+1,2),s=String(e.getFullYear()),o=s+t+a,n=$("#teamSelectionDivisionDropDown").val(),r=$("#teamSelectionHomeTeamDropDown option:selected").text(),i=$("#teamSelectionHomeTeamDropDown").val(),l=pad(i,3),c=$("#teamSelectionAwayTeamDropDown option:selected").text(),d=$("#teamSelectionAwayTeamDropDown").val(),u=pad(d,3),m=o+l+u+n;r==c?alertError("#alertDiv","Please change one of the teams as they can't play themselves"):16==m.length?(sessionStorage.currentGameID=m,checkGameLive(r,c,!1)):8==m.length?alertError("#alertDiv","Please enter a date for the game"):alertError("#alertDiv","Error while creating gameID. Please use the contact form informing me of this error")}function checkGameLive(e,a,t){var s=sessionStorage.currentGameID,o=$.post("http://www.ccrscoring.co.nz/scripts/php/checkgame.php",{gameID:s,homeTeam:e,awayTeam:a,userID:localStorage.userID},function(o){var n=JSON.parse(sessionStorage.scoringGameID);if("success"==o)t||(n.push([s,e,a]),sessionStorage.scoringGameID=JSON.stringify(n)),generateLiveScoring();else if("beingscored"==o.substr(0,11)){var r=o.slice(-8);if(t&&r!=localStorage.userID){for(var i=0;i<n.length;i+=1)n[i][0]==s&&(n.splice(i,1),i-=1,sessionStorage.scoringGameID=JSON.stringify(n));generateGameSelection(),alertError("#alertDiv","Someone has taken over live scoring duties.")}else t&&r==localStorage.userID?generateLiveScoring():alertError("#alertDiv","This game is already being live scored.")}else if("locked"==o){if(t){for(var l=0;l<n.length;l+=1)n[l][0]==s&&(n.splice(l,1),l-=1,sessionStorage.scoringGameID=JSON.stringify(n));generateGameSelection()}alertError("#alertDiv","This game is locked so it can't be updated.")}else alertError("#alertDiv","Error: "+o+". Please try again later. If problem persists, use the contact form")});o.fail(function(){alertError("#alertDiv","Error while checking game status. Please try again later. If problem persists, use the contact form")})}function updateLastTimeScored(){for(var e=JSON.parse(sessionStorage.scoringGameID),a=0;a<e.length;a+=1){$.post("http://www.ccrscoring.co.nz/scripts/php/updatelasttimescored.php",{gameID:e[a][0]},function(e){})}}function stopScoring(e){var a=$.post("http://www.ccrscoring.co.nz/scripts/php/stopscoring.php",{gameID:sessionStorage.currentGameID},function(a){if("success"!=a)alertError("#alertDiv","Error: "+a+". Please use the contact form informing me of this.");else{for(var t=JSON.parse(sessionStorage.scoringGameID),s=0;s<t.length;s+=1)t[s][0]==e&&(t.splice(s,1),s-=1);sessionStorage.scoringGameID=JSON.stringify(t),generateGameSelection(),alertNotification("#alertDiv","You have been logged out")}});a.fail(function(){alertError("#alertDiv","Error while logging out. Please use the contact form informing me of this."),generateGameSelection()})}function changeScore(e){var a=$("#newhomescore").val(),t=$("#newawayscore").val(),s=$("#newminutesplayed").val(),o=areInputsValidChange(a,t,s);if(o[0]){var n="updt"+pad(a,3)+pad(t,3);uploadPlayLive(e,a,t,s,n,"")}else alertError("#alertDiv",o[1])}function sendHalfTime(e,a,t){selectedScoringPlay="",uploadPlayLive(e,a,t,"40","halfTime","","n")}function sendFullTime(e,a,t){selectedScoringPlay="",uploadPlayLive(e,a,t,"80","fullTime","","y")}function uploadScoringPlay(e,a,t){team=selectedScoringPlay.substr(0,4),play=selectedScoringPlay.substr(4),minutesPlayed=document.getElementsByClassName("minutesPlayedInput")[0].value,description="Conversion"==play?"":document.getElementsByClassName("descriptionInput")[0].value;var s=areInputsValidUpload(play,minutesPlayed);if(s[0]){switch(play){case"Try":"home"==team?a+=5:t+=5;break;case"Penalty":case"DropGoal":"home"==team?a+=3:t+=3;break;case"Conversion":"home"==team?a+=2:t+=2}var o=team+play;uploadPlayLive(e,a,t,minutesPlayed,o,description,"n")}else alertError("#alertDiv",s[1])}function uploadPlayLive(e,a,t,s,o,n,r){var i=$.post("http://www.ccrscoring.co.nz/scripts/php/uploadplay.php",{gameID:e,homeScore:a,awayScore:t,minutesPlayed:s,scoringPlay:o,description:n,locked:r},function(s){if("success"==s)if("Try"==selectedScoringPlay.substr(4)){var o="";o+="<div id='dialogContentConversion'>",o+="    <p>Was the conversion successful?</p>",o+="    <button id='conversionYesButton' onclick='uploadConversion("+e+","+a+","+t+")'>Yes</button>",o+="    <button id='conversionNoButton' onclick='closeConversionDialog()'>No</button>",o+="</div>",o+="<div id='blackOverlayConversion'></div>",$("#dialogConversion").empty().append(o),window.scrollTo(0,0),$("#dialogContentConversion").show(),$("#dialogConversion").show(),$("#blackOverlayConversion").show()}else selectedScoringPlay="",generateLiveScoring(),alertSuccess("#alertDiv","Play successfully uploaded");else"locked"==s?alertError("#alertDiv","This game is locked so it can't be updated. If you have uploaded the 'Full Time' play, you can unlock the game by deleting it, otherwise an admin locked the game."):alertError("#alertDiv","Error: "+s+". Please try again later. If problem persists, use the contact form")});i.fail(function(){alertError("#alertDiv","Error while uploading play. Please try again later. If problem persists, use the contact form")})}function uploadConversion(e,a,t){selectedScoringPlay=selectedScoringPlay.substr(0,4)+"Conversion",uploadScoringPlay(e,a,t),closeConversionDialog()}function closeConversionDialog(){$("#dialogContentConversion").hide(),$("#blackOverlayConversion").hide(),$("#dialogConversion").hide(),generateLiveScoring(),alertSuccess("#alertDiv","Play successfully uploaded")}function toggleSelectedScoringPlay(e,a){$(".scoringPlayLive").css("background-color","transparent"),e.style.backgroundColor="#bcbcbc",this.selectedScoringPlay=a}function areInputsValidUpload(e,a){var t="",s=!0;return""==e&&(t+="Please select a play\n",s=!1),(isNaN(a)||parseInt(Number(a))!=a||isNaN(parseInt(a,10))||parseInt(a)<0||parseInt(a)>120)&&(t+="Please enter a valid minutes played (min: 0, max: 120, no decimal)\n",s=!1),[s,t]}function areInputsValidChange(e,a,t){var s="",o=!0;return(isNaN(e)||parseInt(Number(e))!=e||isNaN(parseInt(e,10))||parseInt(e)<0||parseInt(e)>200)&&(s+="Please enter a valid home score\n",o=!1),(isNaN(a)||parseInt(Number(a))!=a||isNaN(parseInt(a,10))||parseInt(a)<0||parseInt(a)>200)&&(s+="Please enter a valid away score\n",o=!1),(isNaN(t)||parseInt(Number(t))!=t||isNaN(parseInt(t,10))||parseInt(t)<0||parseInt(t)>120)&&(s+="Please enter a valid minutes played (min: 0, max: 120, no decimal)\n",o=!1),[o,s]}function togglePlayInSelectedPlays(e,a,t,s,o,n,r,i,l){var c=-1;for(k=0;k<selectedPlays.length&&-1==c;k+=1)selectedPlays[k][1]==t&&(c=k);if(-1==c){if("updt"==s){var d=[a,t,s,o,n,r,i,l];selectedPlays.push(d)}else{var d=[a,t,s,o,n,r];selectedPlays.push(d)}e.style.backgroundColor="#fdffd2"}else selectedPlays.splice(c,1),e.style.backgroundColor="transparent";selectedPlays.sort(function(e,a){return parseInt(a[1])-parseInt(e[1])}),selectedPlays.length>0?$(".deletePlayButtonRow").show():$(".deletePlayButtonRow").hide()}function deleteSelectedPlays(){var e="",a=[-1,-1],t=[],s="";for(i=0;i<selectedPlays.length;i+=1){var o=selectedPlays[i];0==i&&(a[0]=o[4],a[1]=o[5],s=o[0]),t.push(o[1]),shouldScoreBeChanged(o[1])?(e+="i="+i+", index="+o[1]+", Score Changed\n","updt"==o[2]?a=calcScoresUpdate(o[2],o[3],a[0],a[1],o[6],o[7]):("home"==o[2]||"away"==o[2])&&(a=calcScores(o[2],o[3],a[0],a[1]))):e+="i="+i+", index="+o[1]+", Score Not Changed\n"}var n=$.post("http://www.ccrscoring.co.nz/scripts/php/deletescoringplay.php",{gameID:s,indexes:JSON.stringify(t),homeScore:a[0],awayScore:a[1]},function(e){"success"==e?(selectedPlays.length=0,generateLiveScoring(),alertSuccess("#alertDiv","Scoring plays have been deleted")):"locked"==e?alertError("#alertDiv","This game is locked so it can't be updated. If you have uploaded the 'Full Time' play, you can unlock the game by deleting it, otherwise an admin locked the game."):alertError("#alertDiv","Error. Please try again later. If problem persists, use the contact form")});n.fail(function(){alertError("#alertDiv","Error while deleting games. Please try again later. If problem persists, use the contact form")})}function shouldScoreBeChanged(e){var a=document.getElementById("updatePlayIndexes").textContent,t=a.split(",");for(j=1;j<t.length;j+=1){if(parseInt(t[j])>parseInt(e))return!1;parseInt(t[j])==parseInt(e)&&(t.splice(j,1),j-=1,document.getElementById("updatePlayIndexes").textContent=t.join(","))}return!0}function calcScores(e,a,t,s){switch(a){case"Try":"home"==e?t-=5:s-=5;break;case"Penalty":case"DropGoal":"home"==e?t-=3:s-=3;break;case"Conversion":"home"==e?t-=2:s-=2}return[t,s]}function calcScoresUpdate(e,a,t,s,o,n){return 6==a.length?(diffHomeScore=parseInt(a.substr(0,3))-o,diffAwayScore=parseInt(a.substr(3,3))-n):(diffHomeScore=parseInt(a.substr(0,2))-o,diffAwayScore=parseInt(a.substr(2,2))-n),newHomeScore=t-diffHomeScore,newAwayScore=s-diffAwayScore,[newHomeScore,newAwayScore]}function endScoring(e){changeAutoUpdateInterval(NEVER),e&&addBackEvent(["startEndScoring"]),sessionStorage.currentPage="endScoring",setActivePage(),"correct"==sessionStorage.endScoringPassword?generateEndScoring():showEndScoringPasswordContainer()}function addEventsEnd(){$("#endScoringPasswordContainer").on({keydown:function(e){13==e.which&&(e.preventDefault(),$("#checkEndScoringPasswordButton").click())}}),$("#datePicker").pickadate({format:"ddd d mmm yy",today:"Today",clear:"Clear",close:"Cancel",labelMonthNext:"Go to the next month",labelMonthPrev:"Go to the previous month",formatSubmit:"dd/mm/yyyy",hiddenPrefix:"prefix__"})}function showEndScoringPasswordContainer(){hideAllContainers(),setInstructions("endScoringPassword"),$("#endScoringPasswordContainer").show()}function checkEndScoringPassword(){var e=$("#endScoringPasswordInput").val();$.post("http://www.ccrscoring.co.nz/scripts/php/checkpassword.php",{page:"endScoring",password:e},function(e){"correct"==e?(sessionStorage.endScoringPassword="correct",endScoring()):"incorrect"==e?(alertError("#alertDiv","Incorrect password. Please try again."),$("#endScoringPasswordInput").val=""):alertError("#alertDiv","Error: "+e+". Please try again later. If problem persists, use the contact form")}).fail(function(){alertError("#alertDiv","Error while checking password. Please try again later. If problem persists, use the contact form")})}function showEndScoringContainer(){hideAllContainers(),setInstructions("endScoring"),$("#endScoringContainer").show()}function generateEndScoring(){var e="";e+="<div class='row divDropDownRowEnd rowfix'>",e+="    <div class='titleEnd'>Grade:</div>",e+="    <select id='endScoringDivisionDropDown' onchange='changeTeamDropdownsEnd()'>";for(var a=0;a<allDivs.length;a+=1)e+="<option value="+allDivs[a].divisionID+">"+allDivs[a].divisionName+"</option>";e+="    </select>",e+="</div>",e+="<div class='row homeTeamRowEnd rowfix'>",e+="    <div class='titleEnd'>Home Team</div>",e+="    <select id='endScoringHomeTeamDropDown'>";for(var t=0;t<allTeams[selectedDivisionIndexEnd].length;t+=1)e+="    <option value='"+allTeams[selectedDivisionIndexEnd][t].teamID+"'>"+allTeams[selectedDivisionIndexEnd][t].teamName+"</option>";e+="    </select>",e+="</div>",e+="<div class='row homeScoreRowEnd rowfix'>",e+="    <div class='titleEnd'>Home Score</div> <input type='number' id='homeScore'>",e+="    Defaulted <input type='checkbox' id='homeCheckbox' onchange='toggleScoreInputs()'>",e+="</div>",e+="<div class='row homeTriesRowEnd rowfix'>",e+="    <div class='titleEnd'>Home Tries</div> <input type='number' id='homeTries'>",e+="</div>",e+="<div class='row awayTeamRowEnd rowfix'>",e+="    <div class='titleEnd'>Away Team</div>",e+="    <select id='endScoringAwayTeamDropDown'>";for(var s=0;s<allTeams[selectedDivisionIndexEnd].length;s+=1)e+="    <option value='"+allTeams[selectedDivisionIndexEnd][s].teamID+"'>"+allTeams[selectedDivisionIndexEnd][s].teamName+"</option>";e+="    </select>",e+="</div>",e+="<div class='row awayScoreRowEnd rowfix'>",e+="    <div class='titleEnd'>Away Score</div> <input type='number' id='awayScore'>",e+="    Defaulted <input type='checkbox' id='awayCheckbox' onchange='toggleScoreInputs()'>",e+="</div>",e+="<div class='row awayTriesRowEnd rowfix'>",e+="    <div class='titleEnd'>Away Tries</div> <input type='number' id='awayTries'>",e+="</div>",e+="<div class='row datePickerRowEnd rowfix'>",e+="    <div class='titleEnd'>Date</div> <input type='date' id='datePicker'>",e+="</div>",e+="<div class='row submitScoreButtonRow rowfix'>",e+="    <button class='submitScoreButton' onClick='submitScore()'>Submit Score</button>",e+="</div>",$("#endScoringContainer").empty().append(e),$("#endScoringDivisionDropDown").prop("selectedIndex",selectedDivisionIndexEnd),addEventsEnd(),showEndScoringContainer()}function changeTeamDropdownsEnd(){selectedDivisionIndexEnd=$("#endScoringDivisionDropDown").prop("selectedIndex"),generateEndScoring()}function toggleScoreInputs(){var e=document.getElementById("homeCheckbox").checked,a=document.getElementById("awayCheckbox").checked;e||a?(document.getElementById("homeScore").disabled=!0,document.getElementById("awayScore").disabled=!0,document.getElementById("homeTries").disabled=!0,document.getElementById("awayTries").disabled=!0):(document.getElementById("homeScore").disabled=!1,document.getElementById("awayScore").disabled=!1,document.getElementById("homeTries").disabled=!1,document.getElementById("awayTries").disabled=!1)}function checkGameEnd(e,a,t,s,o,n,r,i){var l=$.post("http://www.ccrscoring.co.nz/scripts/php/checkgame.php",{gameID:e,homeTeam:o,awayTeam:n},function(o){"success"==o?uploadPlayEnd(e,a,t,s,r,i):"beingscored"==o?alertError("#alertDiv","This game is already being live scored. Please try again later or select another game."):"locked"==o?alertError("#alertDiv","This game is locked so can't be updated. If you think the score is wrong then use the contact form to send me a message."):alertError("#alertDiv","Error: "+o+". Please try again later. If problem persists, use the contact form")});l.fail(function(){alertError("#alertDiv","Error while checking game status. Please try again later. If problem persists, use the contact form")})}function submitScore(){var e=$("#datePicker")[0].nextElementSibling.nextElementSibling.value,a=e.substr(0,2),t=e.substr(3,2),s=e.substr(6,4),o=$("#endScoringDivisionDropDown").val(),n=$("#endScoringHomeTeamDropDown").val(),r=$("#endScoringHomeTeamDropDown option:selected").text(),i=pad(n,3),l=$("#endScoringAwayTeamDropDown").val(),c=$("#endScoringAwayTeamDropDown option:selected").text(),d=pad(l,3),u=document.getElementById("homeCheckbox").checked,m=document.getElementById("awayCheckbox").checked,g=document.getElementById("homeScore").value,v=document.getElementById("awayScore").value,p=$("#homeTries").val(),h=$("#awayTries").val(),f=areInputsValidEnd(n,l,u,m,g,v,e,p,h);if(f[0]){var w=String(s)+String(t)+String(a)+i+d+o;u?(g=1,v=2,p=0,h=0):m&&(g=2,v=1,p=0,h=0);var S="updt"+pad(g,3)+pad(v,3);checkGameEnd(w,g,v,S,r,c,p,h)}else alertError("#alertDiv",f[1])}function areInputsValidEnd(e,a,t,s,o,n,r,i,l){var c="",d=!0;return e==a&&(c+="Please change one of the teams as they can't play themselves.<br>",d=!1),t&&s&&(c+="Uncheck one of the checkboxes because both teams can't default.<br>",d=!1),t||s||!(isNaN(o)||parseInt(Number(o))!=o||isNaN(parseInt(o,10))||parseInt(o)<0||parseInt(o)>200)||(c+="Please enter a valid home score.<br>",d=!1),t||s||!(isNaN(n)||parseInt(Number(n))!=n||isNaN(parseInt(n,10))||parseInt(n)<0||parseInt(n)>200)||(c+="Please enter a valid away score.<br>",d=!1),""==r&&(c+="Please enter a date.<br>",d=!1),t||s||!(isNaN(i)||parseInt(Number(i))!=i||isNaN(parseInt(i,10))||parseInt(i)<0||parseInt(i)>40)||(c+="Please enter a valid number of home tries.<br>",d=!1),t||s||!(isNaN(l)||parseInt(Number(l))!=l||isNaN(parseInt(l,10))||parseInt(l)<0||parseInt(l)>40)||(c+="Please enter a valid number of away tries.<br>",d=!1),[d,c]}function uploadPlayEnd(e,a,t,s,o,n){var r=$.post("http://www.ccrscoring.co.nz/scripts/php/uploadplay.php",{gameID:e,homeScore:a,awayScore:t,minutesPlayed:"80",scoringPlay:s,description:"",locked:"y",homeTries:o,awayTries:n},function(e){"success"==e?(generateEndScoring(),alertSuccess("#alertDiv","Game successfully uploaded")):alertError("#alertDiv","Error: "+e+". Please try again later. If problem persists, use the contact form")});r.fail(function(){alertError("#alertDiv","Error while uploading score. Please try again later. If problem persists, use the contact form")})}function showContactContainer(){hideAllContainers(),setInstructions("contact"),sessionStorage.currentPage="contact",addBackEvent(["startContactForm"]),setActivePage(),addEventsContact(),$("#contactContainer").show()}function addEventsContact(){$("#contactContainer").on({keydown:function(e){13==e.which&&(e.preventDefault(),$("#contactFormButton").click())}})}function submitContactForm(){var e=$("#contactFormName").val(),a=$("#contactFormEmail").val(),t=$("#contactFormMessage").val();if(""!=t){var s=$.post("http://www.ccrscoring.co.nz/scripts/php/contactform.php",{name:e,email:a,message:t},function(e){"success"==e?($("#contactFormName").val(""),$("#contactFormEmail").val(""),$("#contactFormMessage").val(""),alertSuccess("#alertDiv","Message sent")):alertError("#alertDiv","Message not sent. Please try again later. If problem persists, use the contact form")});s.fail(function(){alertError("#alertDiv","Error while sending message. Please try again later. If problem persists, use the contact form")})}else alertError("#alertDiv","Please enter a message")}function initButtonFlip(){var e=document.querySelector(".btn"),a=e.querySelector(".btn-front"),t=e.querySelector(".btn-back .yes"),s=e.querySelector(".btn-back .no");a.addEventListener("click",function(a){var t=a.clientX-e.offsetLeft,s=a.clientY-e.offsetTop,o=e.offsetWidth,n=e.offsetHeight,r=[{id:"top",x:o/2,y:0},{id:"right",x:o,y:n/2},{id:"bottom",x:o/2,y:n},{id:"left",x:0,y:n/2}];r.sort(function(e,a){return distance(t,s,e.x,e.y)-distance(t,s,a.x,a.y)}),e.setAttribute("data-direction",r.shift().id),e.classList.add("is-open")}),t.addEventListener("click",function(){e.classList.remove("is-open"),deleteSelectedPlays()}),s.addEventListener("click",function(){e.classList.remove("is-open")})}function distance(e,a,t,s){var o=e-t,n=a-s;return Math.sqrt(o*o+n*n)}var backEvents=[],NEVER=1e5,counter=0,allTeams=[],allDivs=[];$(document).ready(function(){var e=$.post("http://www.ccrscoring.co.nz/scripts/php/getteamsdivs.php",{},function(e){for(var a=e[0],t=e[1],s=0;s<t.length;s+=1){var o=parseInt(t[s].divisionID);allTeams[o]=[],allDivs[o]=t[s],allDivs[o].divisionID=pad(allDivs[o].divisionID,2)}for(var n=0;n<a.length;n+=1)"y"==a[n].enabled&&allTeams[parseInt(a[n].division)].push(a[n])},"json");e.fail(function(){alertError("#alertDiv","Error while retrieving info from database. Please try again later. If problem persists, use the contact form")}),e.always(function(){"undefined"!=typeof Storage?("false"==localStorage.instructions&&$("#instructions").hide(),null==localStorage.lastTimeUpdatesChecked&&(localStorage.lastTimeUpdatesChecked=(new Date).toUTCString()),null==localStorage.userID&&(localStorage.userID=pad(Math.floor(1e8*Math.random()),8)),null==sessionStorage.scoringGameID&&(sessionStorage.scoringGameID=JSON.stringify([])),sessionStorage.backEvents=JSON.stringify([[]]),"drawResults"==sessionStorage.currentPage||null==sessionStorage.currentPage?drawResults(!0):"liveScoring"==sessionStorage.currentPage||"gameSelection"==sessionStorage.currentPage?liveScoring(!0):"gameInfo"==sessionStorage.currentPage?gameInfo(sessionStorage.currentGameID,!0):"endScoring"==sessionStorage.currentPage?endScoring(!0):showContactContainer()):alertError("#alertDiv","Sorry, you can't use this website. The minimum browser versions are:\nInternet Explorer 8\nFirefox 3.5\nSafari 4\nGoogle Chrome 5\nOpera 10.50")})}),window.onpopstate=function(e){var a=e.state,t=JSON.parse(sessionStorage.backEvents),s=t[t.length-2][0];void 0==s?history.back():(null!=a&&("startGameInfo"==a.event?(showDrawResultsContainer(),sessionStorage.currentPage="drawResults"):"weekChange"==a.event?changeWeeks(a.weekNumber,!1):"startGameSelection"==a.event?"weekChange"==s?(showDrawResultsContainer(),sessionStorage.currentPage="drawResults"):"startDrawResults"==s?(showDrawResultsContainer(),sessionStorage.currentPage="drawResults"):"startGameInfo"==s?t[t.length-2][1]!=sessionStorage.currentGameID?gameInfo(t[t.length-2][1],!1):(showGameInfoContainer(),sessionStorage.currentPage="gameInfo"):"startEndScoring"==s?(showEndScoringContainer(),sessionStorage.currentPage="endScoring"):"startContactForm"==s&&(showContactContainer(),sessionStorage.currentPage="contact"):"startLiveScoring"==a.event?"startGameSelection"==s&&(showGameSelectionContainer(),sessionStorage.currentPage="gameSelection"):"startEndScoring"==a.event?"weekChange"==s?(showDrawResultsContainer(),sessionStorage.currentPage="drawResults"):"startDrawResults"==s?(showDrawResultsContainer(),sessionStorage.currentPage="drawResults"):"startGameInfo"==s?t[t.length-1][1]!=sessionStorage.currentGameID?gameInfo(t[t.length-1][1],!1):(showGameInfoContainer(),sessionStorage.currentPage="gameInfo"):"startLiveScoring"==s?(showLiveScoringContainer(),sessionStorage.currentPage="liveScoring"):"startGameSelection"==s?(showGameSelectionContainer(),sessionStorage.currentPage="gameSelection"):"startContactForm"==s&&(showContactContainer(),sessionStorage.currentPage="contact"):"startDrawResults"==a.event?"startGameSelection"==s?(showGameSelectionContainer(),sessionStorage.currentPage="gameSelection"):"startLiveScoring"==s?(showLiveScoringContainer(),sessionStorage.currentPage="liveScoring"):"startGameInfo"==s?t[t.length-2][1]!=sessionStorage.currentGameID?gameInfo(t[t.length-2][1],!1):(showGameInfoContainer(),sessionStorage.currentPage="gameInfo"):"startEndScoring"==s?(showEndScoringContainer(),sessionStorage.currentPage="endScoring"):"startContactForm"==s&&(showContactContainer(),sessionStorage.currentPage="contact"):"startContactForm"==a.event&&("startGameSelection"==s?(showGameSelectionContainer(),sessionStorage.currentPage="gameSelection"):"startDrawResults"==s||"weekChange"==s?(showDrawResultsContainer(),sessionStorage.currentPage="drawResults"):"startLiveScoring"==s?(showLiveScoringContainer(),sessionStorage.currentPage="liveScoring"):"startGameInfo"==s?t[t.length-2][1]!=sessionStorage.currentGameID?gameInfo(t[t.length-2][1],!1):(showGameInfoContainer(),sessionStorage.currentPage="gameInfo"):"startEndScoring"==s&&(showEndScoringContainer(),sessionStorage.currentPage="endScoring"))),setActivePage(),t.pop(),sessionStorage.backEvents=JSON.stringify(t))},Date.prototype.addDays=function(e){return this.setDate(this.getDate()+parseInt(e)),this},Date.prototype.toCustomDateString=function(e){var a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],t=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],s="";return e&&(s=t[this.getDay()]),s+" "+this.getDate()+" "+a[this.getMonth()]},Date.prototype.toChangesString=function(){var e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],a=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];if(0==this.getHours())var t="Midnight";else if(this.getHours()>12)var t=this.getHours()-12+"pm";else if(12==this.getHours())var t="Noon";else var t=this.getHours()+"am";return new Date>this.addDays(6)?(this.addDays(-6),this.getDate()+" "+e[this.getMonth()]):(this.addDays(-6),t+" "+a[this.getDay()])},Date.prototype.toAddGameDateString=function(){var e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return this.getDate()+" "+e[this.getMonth()]};var currentWeek=0,numWeeks=18,allGames=[],startDateArray=[2016,1,8],autoUpdateTimer,updateDuration,expandedDivisions=[],gameChangesExpanded=!1,timer,selectedDivisionIndex=0,selectedScoringPlay="",selectedPlays=[],lastTimeScored=null,selectedDivisionIndexEnd=0;
//# sourceMappingURL=scoring.min.js.map